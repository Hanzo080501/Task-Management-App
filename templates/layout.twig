<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Task Management{% endblock %}</title>
    <link rel="stylesheet" href="/app.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block head %}{% endblock %}
</head>
<body>
    <div class="darkmode-toggle">
        <label class="darkmode-switch">
            <input type="checkbox" id="darkModeSwitch">
            <span class="slider">
                <span class="icon sun"><svg width="16" height="16" viewBox="0 0 22 22"><circle cx="11" cy="11" r="5" stroke="#888" stroke-width="2" fill="none"/><g stroke="#888" stroke-width="2"><line x1="11" y1="1" x2="11" y2="4"/><line x1="11" y1="18" x2="11" y2="21"/><line x1="1" y1="11" x2="4" y2="11"/><line x1="18" y1="11" x2="21" y2="11"/><line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/><line x1="15.66" y1="15.66" x2="17.78" y2="17.78"/><line x1="4.22" y1="17.78" x2="6.34" y2="15.66"/><line x1="15.66" y1="6.34" x2="17.78" y2="4.22"/></g></svg></span>
                <span class="icon moon"><svg width="16" height="16" viewBox="0 0 22 22"><path d="M17 14.5A7 7 0 0 1 7.5 5c0-1.5.5-2.5 1-3A8 8 0 1 0 20 16c-0.5 0.5-1.5 1-3 1z" stroke="#888" stroke-width="2" fill="none"/><circle cx="15" cy="9" r="1" fill="#888"/><circle cx="13" cy="7" r="0.5" fill="#888"/></svg></span>
            </span>
        </label>
    </div>
    <div class="app-container">
        <div class="sidebar">
            <div class="brand">
                <i class="fas fa-tasks"></i>
                <span>TaskFlow</span>
            </div>
            <nav>
                <a href="/dashboard" class="nav-item">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/tasks" class="nav-item">
                    <i class="fas fa-columns"></i>
                    <span>Task Board</span>
                </a>
                <a href="/profile" class="nav-item">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="/riwayat" class="nav-item" id="riwayatBtn">
                    <i class="fas fa-history"></i>
                    <span>Riwayat</span>
                </a>
                <a href="/tim" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Tim</span>
                </a>
            </nav>
            <div class="logout">
                <a href="/logout" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <div class="page-title">{% block header %}{% endblock %}</div>
                <div class="user">
                    <div class="avatar-dropdown" id="avatarDropdown">
                        <a href="#" id="avatarBtn" style="text-decoration:none;">
                            {% if user.avatar %}
                                <img src="{{ user.avatar }}" alt="Avatar" style="width:40px;height:40px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px rgba(44,62,80,0.10);border:2px solid #fff;">
                            {% else %}
                                <div class="avatar" data-tooltip="{{ user.username|default('User') }}">
                                    {{ user.username[0]|upper|default('U') }}
                                </div>
                            {% endif %}
                        </a>
                        <div class="avatar-dropdown-menu" id="avatarDropdownMenu">
                            <a href="/profile"><i class="fas fa-user" style="width:18px;"></i> Profile</a>
                            <a href="/logout"><i class="fas fa-sign-out-alt" style="width:18px;"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page-section">
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
    
    {% block scripts %}{% endblock %}
    <style>
body.dark-mode {
    background: #18181b !important;
    color: #e5e7eb !important;
}
.dark-mode .app-container,
.dark-mode .sidebar,
.dark-mode .main-content,
.dark-mode .page-section {
    background: #18181b !important;
    color: #e5e7eb !important;
}
.dark-mode .sidebar {
    background: #23232a !important;
    border-right: 1.5px solid #27272a;
}
.dark-mode .sidebar .nav-item,
.dark-mode .sidebar .brand,
.dark-mode .sidebar .logout {
    color: #e5e7eb !important;
}
.dark-mode .sidebar .nav-item.active,
.dark-mode .sidebar .nav-item:hover {
    background: #27272a !important;
    color: #6366f1 !important;
}
.dark-mode .main-content {
    background: #18181b !important;
}
.dark-mode .page-section {
    background: #18181b !important;
}
.dark-mode .dashboard-grid > div,
.dark-mode .dashboard-main-grid > div,
.dark-mode .riwayat-page-card,
.dark-mode .profile-card-wp,
.dark-mode .task-table,
.dark-mode .task-table-wrapper,
.dark-mode .task-list-controls > *,
.dark-mode .modal-content,
.dark-mode .task-card,
.dark-mode .riwayat-popover,
.dark-mode .riwayat-page-item,
.dark-mode .auth-card {
    background: #23232a !important;
    color: #e5e7eb !important;
    border-color: #27272a !important;
}
.dark-mode input,
.dark-mode textarea,
.dark-mode select {
    background: #18181b !important;
    color: #e5e7eb !important;
    border-color: #27272a !important;
}
.dark-mode .btn-primary {
    background: linear-gradient(90deg,#6366f1,#818cf8) !important;
    color: #fff !important;
}
.dark-mode .btn-secondary {
    background: #23232a !important;
    color: #e5e7eb !important;
    border: 1.5px solid #27272a !important;
}
.dark-mode .btn-primary:hover {
    background: linear-gradient(90deg,#4f46e5,#6366f1) !important;
}
.dark-mode .btn-secondary:hover {
    background: #18181b !important;
    color: #6366f1 !important;
}
.dark-mode .avatar-dropdown-menu {
    background: #23232a !important;
    color: #e5e7eb !important;
    border-color: #27272a !important;
}
.dark-mode .avatar-dropdown-menu a:hover {
    background: #18181b !important;
    color: #6366f1 !important;
}
.dark-mode .task-table th,
.dark-mode .task-table td {
    background: #23232a !important;
    color: #e5e7eb !important;
    border-color: #27272a !important;
}
.dark-mode .modal-content {
    background: #23232a !important;
    color: #e5e7eb !important;
}
.dark-mode .form-control:focus {
    border-color: #6366f1 !important;
    background: #18181b !important;
}
.dark-mode .riwayat-item,
.dark-mode .riwayat-empty {
    background: #23232a !important;
    color: #e5e7eb !important;
}
.dark-mode .riwayat-title-task {
    color: #10b981 !important;
}
.dark-mode .profile-avatar-wp {
    background: linear-gradient(135deg,#6366f1,#4f46e5 80%) !important;
}
.dark-mode .profile-save-btn {
    background: linear-gradient(90deg,#6366f1,#818cf8) !important;
    color: #fff !important;
}
.dark-mode .profile-save-btn:hover {
    background: linear-gradient(90deg,#4f46e5,#6366f1) !important;
}
.dark-mode .riwayat-page-item {
    background: #23232a !important;
    color: #e5e7eb !important;
    border-left: 5px solid #10b98122 !important;
}
.dark-mode .riwayat-page-title-task {
    color: #10b981 !important;
}
.dark-mode .riwayat-page-deadline {
    color: #a3a3a3 !important;
}
.dark-mode .riwayat-empty {
    color: #71717a !important;
}
.dark-mode .dashboard-grid > div,
.dark-mode .dashboard-main-grid > div {
    box-shadow: 0 2px 8px rgba(44,62,80,0.18) !important;
}
.dark-mode .task-table-wrapper {
    box-shadow: 0 2px 8px rgba(44,62,80,0.18) !important;
}
.dark-mode .modal-overlay {
    background: rgba(24,24,27,0.88) !important;
}
.dark-mode .switch input:checked + .slider {
    background: #6366f1 !important;
}
.dark-mode .header {
    background: #23232a !important;
    border-bottom: 1.5px solid #27272a !important;
    color: #e5e7eb !important;
}
.avatar-dropdown {
    position: relative;
    display: inline-block;
}
.avatar-dropdown-menu {
    display: none;
    position: absolute;
    right: 0;
    top: 48px;
    background: #fff;
    min-width: 150px;
    box-shadow: 0 4px 16px rgba(44,62,80,0.13);
    border-radius: 10px;
    z-index: 1001;
    padding: 0.5rem 0;
    animation: fadeIn 0.18s;
}
.avatar-dropdown-menu.show { display: block; }
.avatar-dropdown-menu a {
    display: block;
    padding: 0.7rem 1.2rem;
    color: #334155;
    text-decoration: none;
    font-size: 1.05rem;
    transition: background 0.18s;
}
.avatar-dropdown-menu a:hover {
    background: #f1f5f9;
    color: #6366f1;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: none; }
}
.riwayat-popover {
    display: none;
    position: fixed;
    left: 70px;
    top: 80px;
    width: 320px;
    max-width: 90vw;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 8px 32px 0 rgba(31,38,135,0.13);
    z-index: 2000;
    padding: 1.2rem 1.1rem 1.1rem 1.1rem;
    border: 1.5px solid #f1f5f9;
    animation: fadeIn 0.18s;
}
.riwayat-title {
    font-weight: 700;
    font-size: 1.08rem;
    color: #10b981;
    margin-bottom: 1rem;
}
.riwayat-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}
.riwayat-item {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.5rem 0.2rem;
    border-bottom: 1px solid #f1f5f9;
    font-size: 1.01rem;
}
.riwayat-title-task {
    font-weight: 600;
    color: #10b981;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.riwayat-deadline {
    color: #94a3b8;
    font-size: 0.93rem;
    margin-left: 0.5rem;
    white-space: nowrap;
}
.riwayat-empty {
    color: #cbd5e1;
    text-align: center;
    font-size: 0.98rem;
    padding: 1.2rem 0 0.5rem 0;
}
.priority-dot {
    display: inline-block;
    width: 13px;
    height: 13px;
    border-radius: 50%;
    margin-right: 2px;
    box-shadow: 0 1px 4px rgba(44,62,80,0.10);
    border: 2px solid #fff;
}
.priority-dot.high { background: #ef4444; }
.priority-dot.medium { background: #f59e0b; }
.priority-dot.low { background: #6366f1; }
@media (max-width: 600px) {
    .riwayat-popover { left: 10vw; top: 70px; width: 92vw; }
    .priority-dot { width: 10px; height: 10px; }
}
.darkmode-toggle {
    position: fixed;
    top: 18px;
    right: 80px;
    z-index: 2001;
}
.darkmode-switch {
    display: flex;
    align-items: center;
    background: transparent;
    border-radius: 32px;
    padding: 0;
    box-shadow: none;
    position: relative;
    min-width: 68px;
    user-select: none;
}
.darkmode-switch input[type="checkbox"] {
    display: none;
}
.darkmode-switch .slider {
    position: relative;
    width: 48px;
    height: 20px;
    background: #e5e7eb;
    border-radius: 32px;
    margin: 0 6px;
    box-shadow: 0 2px 8px rgba(44,62,80,0.10);
    display: flex;
    align-items: center;
    transition: background 0.3s;
    overflow: hidden;
}
.darkmode-switch .icon {
    width: 12px;
    height: 12px;
    pointer-events: none;
    opacity: 0.5;
    transition: opacity 0.3s;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
}
.darkmode-switch .icon.sun {
    left: 2px;
    top: 38%;
}
.darkmode-switch .icon.moon {
    right: 2px;
    top: 38%;
}
.darkmode-switch .slider:before {
    content: '';
    position: absolute;
    left: 2px;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(44,62,80,0.10);
    border: 1px solid #d1d5db;
    transition: left 0.3s, background 0.3s;
}
.darkmode-switch input[type="checkbox"]:checked ~ .slider {
    background: #23232a;
}
.darkmode-switch input[type="checkbox"]:checked ~ .slider:before {
    left: 32px;
    background: #fff;
}
.darkmode-switch input[type="checkbox"]:checked ~ .slider .icon.sun {
    opacity: 0.3;
}
.darkmode-switch input[type="checkbox"]:checked ~ .slider .icon.moon {
    opacity: 1;
}
.darkmode-switch input[type="checkbox"]:not(:checked) ~ .slider .icon.sun {
    opacity: 1;
}
.darkmode-switch input[type="checkbox"]:not(:checked) ~ .slider .icon.moon {
    opacity: 0.3;
}
</style>
    <script>
const avatarBtn = document.getElementById('avatarBtn');
const dropdown = document.getElementById('avatarDropdownMenu');
if (avatarBtn && dropdown) {
    avatarBtn.addEventListener('click', function(e) {
        e.preventDefault();
        dropdown.classList.toggle('show');
    });
    document.addEventListener('mousedown', function(e) {
        if (!avatarBtn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.remove('show');
        }
    });
}
const riwayatBtn = document.getElementById('riwayatBtn');
const riwayatPopover = document.getElementById('riwayatPopover');
if (riwayatBtn && riwayatPopover) {
    riwayatBtn.addEventListener('click', function(e) {
        e.preventDefault();
        riwayatPopover.style.display = riwayatPopover.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('mousedown', function(e) {
        if (!riwayatPopover.contains(e.target) && !riwayatBtn.contains(e.target)) {
            riwayatPopover.style.display = 'none';
        }
    });
}
// Dark mode toggle logic
const darkModeSwitch = document.getElementById('darkModeSwitch');
const darkModeLabel = document.getElementById('darkModeLabel');
function setDarkMode(on) {
    if (on) {
        document.body.classList.add('dark-mode');
        localStorage.setItem('darkMode', '1');
        darkModeSwitch.checked = true;
    } else {
        document.body.classList.remove('dark-mode');
        localStorage.setItem('darkMode', '0');
        darkModeSwitch.checked = false;
    }
    // Update chart colors jika ada
    if (typeof updateChartColors === 'function') updateChartColors();
}
darkModeSwitch.addEventListener('change', function() {
    setDarkMode(this.checked);
});
// On load
if (localStorage.getItem('darkMode') === '1') {
    setDarkMode(true);
} else {
    setDarkMode(false);
}
</script>
</body>
</html>